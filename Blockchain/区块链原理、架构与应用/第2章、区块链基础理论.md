## 2.1 区块链体系结构

## 2.2 区块链加密技术

## 2.3 区块链共识机制

### 2.3.1 实用拜占庭容错算法
讨论场景：少数节点作恶

1. 拜占庭将军问题
*  问题描述 ：多个将军通过信使达成一致性决定，其中的叛徒努力向不同的将军发送不同的消息干扰一致性达成

2. 拜占庭容错（BFT）
* 拜占庭容错：一个系统中存在少量的拜占庭错误节点，仍能达成共识

3.实用拜占庭容错算法（PBFT）
* 问题核心：如何使将军们收到正确的命令，并做出正确的反应
* 解决思路：每个节点都对周围节点进行信息正确性的确认，用通信次数换取信用

系统中共有`3f+1`个复制节点，其中最多f个节点为拜占庭错误节点，每个节点都运行一个有限状态机的副本
* 视图：时间段编号
* 主节点编号： p = v mod |R|
    * v：视图编号
    * R：复制节点的集合
>请求过程 <br>
（1）请求(request)：客户端向主节点发送请求调用服务<br>
（2）预准备(pre-prepare)：主节点向其余节点组播客户端请求<br>
（3）准备(prepare)：各复制节点收到组播后，再次组播给其他复制节点<br>
（4）确认(commit)：复制节点若收到超过~~一定~~数量的相同请求，则进入commit阶段，组播commit请求<br>
（5）回复(reply)：处于commit阶段的节点，若收到超过一定数量的相同请求，则对客户端进行反馈。客户端等待`f+1`个不同复制节点返回相同的结果。

N>=3f+1可容错的证明
```
Q: 达成共识所需要的最少节点数
f: 拜占庭错误节点
Q < N-f && 2Q-N > f
=> N>3f
```