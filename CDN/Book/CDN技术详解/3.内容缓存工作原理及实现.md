# 第3章 内容缓存工作原理及实现
## 3.1 内容缓存技术的发展背景
### 3.1.1 网站的问题和需求
略
### 3.1.2 CDN出现前的网站服务技术
#### 1. 扩展技术 Scale up/Scale out
**Scale up**：提高单台网站服务器的硬件水平
**Scale out**：用服务器集群方式服务，需要引入负载均衡设备

#### 2. 镜像技术 Mirroring
镜像时冗余的一种类型，主要用于备份。对于镜像站点，每个镜像都是源站百分之百的复制。

#### 3. 缓存技术 Cache
缓存是通过缓存设备将访问过的数字媒体存储起来，为后续的重复访问使用。

## 3.2 Cache设备的工作方式和设计要求
通常，根据缓存内容的不同可以将Cache设备分为Web Cache和流媒体Cache两大类
- **Web Cache设备**主要用于缓存普通网页的内容和对象，同时大多数设备也具备文件下载、流媒体服务等能力
- **流媒体Cache设备**主要针对视频流媒体服务进行加速，功能相对单一

生产商不会在生产时对这两种产品进行区分，不过CDN服务运营商会采用不同的技术路线来进行开发和优化。

### 3.2.1 正向代理
正向代理（Forward Proxy）方式下，使用者需要配置其网络访问的代理服务器地址为Cache设备的地址，内网用户对互联网的所有访问都通过代理服务器代理完成。*使用者也可以仅对特殊应用设置代理服务器*。

正向代理多用于中小企业网络环境，Cache设备作为企业网的出口网关提供代理服务、内容缓存、Internet访问控制、安全认证等功能。

### 3.2.2 反向代理
反向代理（Backward Proxy）方式中，用户不需要配置代理服务器地址，Cache设备的地址作为被访问域的服务地址写入DNS记录，并利用Cache设备的内容路由/交换能力完成代理访问。反向代理专门对定制的内容进行加速。

反向代理可以实施透明的内容缓存，用户不会感觉到任何Cache设备的存在。

在反向代理方式下，当Cache数量较多，网络规模较大时，需要部署GSLB（全局负载均衡），并对全网的内容分发策略进行设定，就形成了CDN网络的雏形。

代理服务器（Cache）和应用服务器（Server）部署在同一网络环境中，应用对外地址为反向代理服务器的地址。用户请求服务时访问的是代理服务器的地址。

### 3.2.3 透明代理
透明代理（）方式下，用户的浏览器不需要配置代理服务地址，用户主机的请求数据会在发往目标主机前被透明代理截获处理。可看作是通过网络设备或协议实现的正向代理工作方式。
- 方案一，用户的路由设备配置WCCP功能，把指定的用户流量转发给Cache，由Cache对用户提供服务。
- 方案二，利用四层交换机将用户的流量转发给Cache，由Cache对用户提供服务。
